(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6235],{1215:(e,t,a)=>{"use strict";a.d(t,{dj:()=>h,oR:()=>u});var s=a(2149);let r=0,l=new Map,i=e=>{if(l.has(e))return;let t=setTimeout(()=>{l.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);l.set(e,t)},n=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?i(a):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},o=[],c={toasts:[]};function d(e){c=n(c,e),o.forEach(e=>{e(c)})}function u(e){let{...t}=e,a=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>d({type:"DISMISS_TOAST",toastId:a});return d({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||s()}}}),{id:a,dismiss:s,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function h(){let[e,t]=s.useState(c);return s.useEffect(()=>(o.push(t),()=>{let e=o.indexOf(t);e>-1&&o.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},1312:(e,t,a)=>{Promise.resolve().then(a.bind(a,4850))},2184:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(1018).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},2486:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(1018).A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},3565:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(1018).A)("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]])},3938:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(1018).A)("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]])},4850:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>N});var s=a(8081),r=a(2149),l=a(5160),i=a(1888),n=a(2716),o=a(5651),c=a(2184),d=a(1018);let u=(0,d.A)("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);var h=a(2486),p=a(7188),g=a(3565),m=a(5058),x=a(3938);let f=(0,d.A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);var y=a(1215),v=a(7950),j=a.n(v),w=a(4909);function N(){let{user:e,loading:t}=(0,i.A)(),{history:a,loading:d,refreshHistory:v,removeFromHistory:N}=(0,n.W)(),[b,k]=(0,r.useState)(null),[C,S]=(0,r.useState)(!1),{toast:A}=(0,y.dj)(),[T,R]=(0,r.useState)([]),E=async()=>{S(!0);try{await v(),A({title:"Force Reloading Gallery",description:"Clearing cache and reloading page...",duration:3e3}),setTimeout(()=>{window.location.reload()},1e3)}catch(e){console.error("Error force reloading gallery:",e),S(!1),A({title:"Error",description:"Failed to force reload gallery. Please try again.",variant:"destructive",duration:5e3})}};return((0,r.useEffect)(()=>{let e=new Map;a.forEach(t=>{t&&t.id&&("image"===t.type||"video"===t.type)&&Array.isArray(t.output)&&t.output.length>0&&"string"==typeof t.output[0]&&""!==t.output[0].trim()&&(t.type=t.type||"image",e.set(t.id,t))});let t=Array.from(e.values()).sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime());console.log("Processed ".concat(a.length," history items into ").concat(t.length," unique gallery items")),R(t),b&&!e.has(b.id)?k(null):!b&&t.length>0&&k(t[0])},[a,b]),t||d)?(0,s.jsx)("div",{className:"container mx-auto px-4 py-8 flex items-center justify-center min-h-[60vh]",children:(0,s.jsx)(c.A,{className:"h-12 w-12 animate-spin mx-auto text-primary"})}):e?(0,s.jsx)("div",{className:"container mx-auto px-4 py-8 max-w-full lg:max-w-screen-2xl",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mx-auto",children:[(0,s.jsx)("div",{className:"lg:col-span-1",children:(0,s.jsxs)(w.GlassCard,{className:"w-full",children:[(0,s.jsxs)(w.GlassCardHeader,{className:"flex flex-row items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(w.GlassCardTitle,{children:"Your Gallery"})," ",(0,s.jsx)(w.GlassCardDescription,{children:"All your generated images and videos"})," "]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(j(),{href:"/debug",children:(0,s.jsx)(l.$,{variant:"outline",size:"sm",className:"text-white hover:bg-white/10",children:"Debug"})}),(0,s.jsx)(l.$,{variant:"outline",size:"sm",onClick:E,disabled:C,className:"text-white hover:bg-white/10",children:C?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.A,{className:"h-4 w-4 mr-2 animate-spin"}),"Reloading..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u,{className:"h-4 w-4 mr-2"}),"Force Reload"]})}),(0,s.jsxs)(l.$,{variant:"ghost",size:"icon",onClick:v,className:"text-white hover:bg-white/10",children:[(0,s.jsx)(h.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Refresh"})]})]})]}),0===T.length?(0,s.jsx)(w.GlassCardContent,{children:(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-10 text-center",children:[" ",(0,s.jsx)(p.A,{className:"h-10 w-10 text-gray-300 mb-2"}),(0,s.jsx)("p",{className:"text-gray-300",children:"No items generated yet"})," "]})}):(0,s.jsx)(w.GlassCardContent,{className:"p-4",children:(0,s.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-2 lg:grid-cols-3 gap-4",children:T.map(e=>(0,s.jsxs)("div",{className:"relative group aspect-square bg-black/20 rounded-md overflow-hidden",children:[" ","image"===e.type?(0,s.jsx)(o._,{src:e.output&&e.output.length>0?e.output[0]:"",alt:"Generated image ".concat(e.id),fill:!0,style:{objectFit:"cover"},className:"cursor-pointer transition-all duration-300 ease-in-out ".concat((null==b?void 0:b.id)===e.id?"ring-2 ring-primary ring-offset-2 ring-offset-background":"hover:scale-105"),fallbackSrc:"/placeholder/image.svg",useProxy:!0,onClick:()=>k(e)}):(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center cursor-pointer transition-all duration-300 ease-in-out ".concat((null==b?void 0:b.id)===e.id?"ring-2 ring-primary ring-offset-2 ring-offset-background":"hover:opacity-80"),onClick:()=>k(e),children:(0,s.jsx)(g.A,{className:"w-1/2 h-1/2 text-gray-400"})})]},"gallery-item-".concat(e.id)))})})]})}),(0,s.jsx)("div",{className:"lg:col-span-1",children:(0,s.jsxs)(w.GlassCard,{className:"w-full sticky top-24",children:[(0,s.jsxs)(w.GlassCardHeader,{className:"flex flex-row items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(w.GlassCardTitle,{children:"Preview"})," ",(0,s.jsx)(w.GlassCardDescription,{children:"Selected item details"})," "]}),b&&(0,s.jsxs)(l.$,{variant:"ghost",size:"icon",onClick:()=>{v();let e=b.id;k(null),setTimeout(()=>{let t=T.find(t=>t.id===e);t?k(t):k(null)},100)},className:"text-white hover:bg-white/10",children:[(0,s.jsx)(h.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Refresh Item"})," "]})]}),(0,s.jsx)(w.GlassCardContent,{children:b?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"relative w-full aspect-video overflow-hidden rounded-lg bg-black/20 flex items-center justify-center",children:"image"===b.type&&b.output&&b.output.length>0?(0,s.jsx)(o._,{src:b.output[0]||"",alt:"Selected image preview",fill:!0,style:{objectFit:"contain"},className:"max-h-full max-w-full",fallbackSrc:"/placeholder/image.svg",useProxy:!0}):"video"===b.type&&b.output&&b.output.length>0?(0,s.jsx)("video",{src:b.output[0],controls:!0,playsInline:!0,muted:!0,autoPlay:!0,loop:!0,className:"w-full h-full object-contain",onClick:e=>{let t=e.currentTarget;t.paused?t.play().catch(e=>console.error("Error playing video:",e)):t.pause()},onError:e=>console.error("Preview Video Error:",e.target.error)},b.output[0]):(0,s.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,s.jsx)("p",{className:"text-gray-400",children:"No preview available"})})}),(0,s.jsxs)("div",{className:"space-y-2 text-sm pt-2",children:[" ",(0,s.jsx)("h3",{className:"font-medium text-white",children:"Prompt"}),(0,s.jsx)("p",{className:"text-gray-300 bg-black/10 p-3 rounded text-xs break-words",children:b.input.prompt}),(b.model||b.input.model)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h3",{className:"font-medium text-white pt-1",children:"Model"}),(0,s.jsx)("p",{className:"text-gray-300 text-xs",children:b.model||b.input.model})]})]})]}):(0,s.jsxs)("div",{className:"flex items-center justify-center py-12 h-[50vh]",children:[(0,s.jsx)("p",{className:"text-gray-300",children:"Select an item from the gallery to view details"})," "]})}),b&&b.output&&b.output.length>0&&(0,s.jsxs)(w.o,{className:"flex justify-end space-x-2 pt-4",children:[(0,s.jsxs)(l.$,{variant:"outline",size:"icon",className:"border-white/10 bg-black/20 text-white hover:bg-white/10",onClick:()=>{var e;let t=null===(e=b.output)||void 0===e?void 0:e[0];if(!t)return;let a="video"===b.type?"mp4":"webp",s=document.createElement("a");s.href=t,s.download="mrkniai-".concat(b.type,"-").concat(b.id,".").concat(a),document.body.appendChild(s),s.click(),document.body.removeChild(s)},children:[(0,s.jsx)(m.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Download"})]}),(0,s.jsxs)(l.$,{variant:"outline",size:"icon",className:"border-white/10 bg-black/20 text-white hover:bg-white/10",onClick:()=>{var e;let t=null===(e=b.output)||void 0===e?void 0:e[0];t&&(navigator.share?navigator.share({title:"MrkniAI Generated ".concat(b.type),url:t}).catch(console.error):(navigator.clipboard.writeText(t),A({title:"URL Copied!",description:"Output URL copied to clipboard."})))},children:[(0,s.jsx)(x.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Share"})]}),(0,s.jsxs)(l.$,{variant:"destructive",size:"icon",className:"border-red-500/30 bg-red-900/30 text-red-200 hover:bg-red-900/50",onClick:async()=>{if(!b||!b.type)return;let e=b.id,t=b.type;k(null),R(t=>t.filter(t=>t.id!==e));try{await N(e,t),A({title:"Deleted",description:"".concat(t," item removed from history.")})}catch(e){console.error("Error deleting item:",e),A({title:"Error",description:"Failed to delete ".concat(t,"."),variant:"destructive"}),v()}},children:[(0,s.jsx)(f,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Delete"})]})]})]})})]})}):(0,s.jsx)("div",{className:"container mx-auto px-4 py-8 flex flex-col items-center min-h-[60vh] justify-center",children:(0,s.jsxs)(w.GlassCard,{className:"w-full max-w-md",children:[(0,s.jsxs)(w.GlassCardHeader,{children:[(0,s.jsx)(w.GlassCardTitle,{children:"Authentication Required"}),(0,s.jsx)(w.GlassCardDescription,{children:"Please sign in to view your gallery"})]}),(0,s.jsx)(w.GlassCardContent,{className:"flex justify-center",children:(0,s.jsx)(j(),{href:"/",children:(0,s.jsx)(l.$,{children:"Go to Sign In"})})})]})})}},4909:(e,t,a)=>{"use strict";a.d(t,{GlassCard:()=>i,GlassCardContent:()=>d,GlassCardDescription:()=>c,GlassCardHeader:()=>n,GlassCardTitle:()=>o,o:()=>u});var s=a(8081),r=a(6810),l=a(7687);function i(e){let{className:t,...a}=e;return(0,s.jsx)(r.Zp,{className:(0,l.cn)("glass-card",t),...a})}function n(e){let{className:t,...a}=e;return(0,s.jsx)(r.aR,{className:(0,l.cn)("text-on-bg",t),...a})}function o(e){let{className:t,...a}=e;return(0,s.jsx)(r.ZB,{className:(0,l.cn)("text-on-bg",t),...a})}function c(e){let{className:t,...a}=e;return(0,s.jsx)(r.BT,{className:(0,l.cn)("text-white/70",t),...a})}function d(e){let{className:t,...a}=e;return(0,s.jsx)(r.Wu,{className:(0,l.cn)(t),...a})}function u(e){let{className:t,...a}=e;return(0,s.jsx)(r.wL,{className:(0,l.cn)(t),...a})}},5058:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(1018).A)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},5651:(e,t,a)=>{"use strict";a.d(t,{_:()=>o});var s=a(8081),r=a(2149),l=a(5186),i=a(7553);let n=e=>{if(!e||e.startsWith("/")||e.startsWith("data:"))return e;if((0,i.Pr)(e)){console.log("Not proxying Supabase Storage URL: ".concat(e));let t=(0,i.pi)(e);return console.log("Using fixed Supabase Storage URL: ".concat(t)),t}try{let t=btoa(encodeURIComponent(e));return"/api/image-proxy?url=".concat(t)}catch(t){return console.error("Error encoding URL for proxy: ".concat(e),t),e}};function o(e){let{src:t,alt:a,fallbackSrc:o="/placeholder/image.svg",useProxy:c=!0,...d}=e,[u,h]=(0,r.useState)(!1),[p,g]=(0,r.useState)([]),m="string"==typeof t?t:(null==t?void 0:t.src)||"",x=e=>!!e&&""!==e.trim()&&((0,i.Pr)(e)?(console.log("Found valid Supabase Storage URL: ".concat(e)),!0):(0,i.VP)(e)),f=e=>{if(!e.includes("/images/images-ai/")||!e.includes("."))return null;let t=e.lastIndexOf("."),a=e.substring(0,t),s=e.substring(t+1),r=["webp","jpg","jpeg","png","svg"].filter(e=>e!==s&&!p.includes(e));if(r.length>0){let e=r[0];return g([...p,e]),"".concat(a,".").concat(e)}return null},[y,v]=(0,r.useState)(()=>m&&""!==m&&x(m)?c&&"string"==typeof m?n(m):m:o);return r.useEffect(()=>{if(h(!1),g([]),"string"==typeof m&&(0,i.Pr)(m)){console.log("Image: Found Supabase Storage URL: ".concat(m));let e=(0,i.pi)(m);console.log("Image: Using fixed Supabase Storage URL: ".concat(e)),v(e),setTimeout(()=>{u||(console.log("Image: Forcing reload of Supabase Storage URL: ".concat(e)),v((0,i.zq)(e)))},500);return}if(m&&""!==m&&x(m)){if(!u){let e=c&&"string"==typeof m?n(m):m;console.log("Image: Using ".concat(c?"proxied":"direct"," URL: ").concat(e)),v(e)}}else console.log("Image: Invalid source URL: ".concat(m,", using fallback")),v(o),h(!0)},[t,m,o,c]),(0,s.jsx)(l.default,{...d,src:u?o:y,alt:a,onError:()=>{if(!u){if(console.log("Image error loading: ".concat(m)),console.log("Current actualSrc: ".concat(y)),console.log("useProxy setting: ".concat(c)),"string"==typeof m&&(0,i.Pr)(m)){console.log("Error loading Supabase Storage URL: ".concat(m));let e=(0,i.pi)(m);if(e!==m){console.log("Trying with fixed URL: ".concat(e)),v(e);return}if(c){console.log("Trying Supabase URL without proxy: ".concat(m)),v(m);return}let t=(0,i.zq)(m);console.log("Trying with cache-busting parameter: ".concat(t)),v(t);return}if("string"==typeof m){let e=f(m);if(e){console.log("Trying alternative extension: ".concat(e));let t=c?n(e):e;console.log("New source with alternative extension: ".concat(t)),v(t);return}}console.log("Using fallback for: ".concat(m)),h(!0),v(o)}}})}},6810:(e,t,a)=>{"use strict";a.d(t,{BT:()=>c,Wu:()=>d,ZB:()=>o,Zp:()=>i,aR:()=>n,wL:()=>u});var s=a(8081),r=a(2149),l=a(7687);let i=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...r})});i.displayName="Card";let n=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",a),...r})});n.displayName="CardHeader";let o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",a),...r})});o.displayName="CardTitle";let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",a),...r})});c.displayName="CardDescription";let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",a),...r})});d.displayName="CardContent";let u=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",a),...r})});u.displayName="CardFooter"},7188:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(1018).A)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])}},e=>{var t=t=>e(e.s=t);e.O(0,[1144,928,7950,5186,6705,497,954,7358],()=>t(1312)),_N_E=e.O()}]);