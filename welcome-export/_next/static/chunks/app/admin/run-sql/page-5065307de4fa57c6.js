(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7409],{244:(e,n,r)=>{"use strict";r.d(n,{DX:()=>l,TL:()=>s});var t=r(2149),i=r(9078),a=r(8081);function s(e){let n=function(e){let n=t.forwardRef((e,n)=>{let{children:r,...a}=e;if(t.isValidElement(r)){var s;let e,l;let o=(s=r,(l=(e=Object.getOwnPropertyDescriptor(s.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?s.ref:(l=(e=Object.getOwnPropertyDescriptor(s,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?s.props.ref:s.props.ref||s.ref),d=function(e,n){let r={...n};for(let t in n){let i=e[t],a=n[t];/^on[A-Z]/.test(t)?i&&a?r[t]=(...e)=>{a(...e),i(...e)}:i&&(r[t]=i):"style"===t?r[t]={...i,...a}:"className"===t&&(r[t]=[i,a].filter(Boolean).join(" "))}return{...e,...r}}(a,r.props);return r.type!==t.Fragment&&(d.ref=n?(0,i.t)(n,o):o),t.cloneElement(r,d)}return t.Children.count(r)>1?t.Children.only(null):null});return n.displayName=`${e}.SlotClone`,n}(e),r=t.forwardRef((e,r)=>{let{children:i,...s}=e,l=t.Children.toArray(i),o=l.find(d);if(o){let e=o.props.children,i=l.map(n=>n!==o?n:t.Children.count(e)>1?t.Children.only(null):t.isValidElement(e)?e.props.children:null);return(0,a.jsx)(n,{...s,ref:r,children:t.isValidElement(e)?t.cloneElement(e,void 0,i):null})}return(0,a.jsx)(n,{...s,ref:r,children:i})});return r.displayName=`${e}.Slot`,r}var l=s("Slot"),o=Symbol("radix.slottable");function d(e){return t.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===o}},3354:(e,n,r)=>{"use strict";r.r(n),r.d(n,{default:()=>o});var t=r(8081),i=r(2149),a=r(5160),s=r(6810),l=r(4666);function o(){let[e,n]=(0,i.useState)('-- Drop the foreign key constraint if it exists\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.table_constraints \n    WHERE constraint_name = \'generated_images_generation_id_fkey\' \n    AND table_name = \'generated_images\'\n  ) THEN\n    ALTER TABLE public.generated_images DROP CONSTRAINT generated_images_generation_id_fkey;\n  END IF;\nEND\n$$;\n\n-- Create a new temporary table with text id\nCREATE TABLE IF NOT EXISTS public.image_generations_new (\n  id TEXT PRIMARY KEY,\n  user_id UUID NOT NULL,\n  prompt TEXT NOT NULL,\n  negative_prompt TEXT,\n  width INTEGER NOT NULL,\n  height INTEGER NOT NULL,\n  steps INTEGER NOT NULL,\n  guidance_scale NUMERIC NOT NULL,\n  scheduler TEXT NOT NULL,\n  seed BIGINT,\n  model TEXT,\n  status TEXT,\n  error TEXT,\n  created_at TIMESTAMP WITH TIME ZONE DEFAULT now() NOT NULL\n);\n\n-- Rename tables\nDROP TABLE IF EXISTS public.image_generations_old;\n\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.tables \n    WHERE table_name = \'image_generations\' \n    AND table_schema = \'public\'\n  ) THEN\n    ALTER TABLE public.image_generations RENAME TO image_generations_old;\n  END IF;\nEND\n$$;\n\nALTER TABLE public.image_generations_new RENAME TO image_generations;\n\n-- Create indexes and RLS policies\nCREATE INDEX IF NOT EXISTS idx_image_generations_user_id ON public.image_generations(user_id);\n\nALTER TABLE public.image_generations ENABLE ROW LEVEL SECURITY;\n\n-- Drop existing policies if they exist\nDROP POLICY IF EXISTS "Users can view their own image generations" ON public.image_generations;\nDROP POLICY IF EXISTS "Service role can manage all image generations" ON public.image_generations;\n\n-- Create new policies\nCREATE POLICY "Users can view their own image generations" \n  ON public.image_generations FOR SELECT \n  USING (auth.uid() = user_id);\n\nCREATE POLICY "Service role can manage all image generations" \n  ON public.image_generations FOR ALL \n  USING (true);\n\n-- Now fix the generated_images table to use TEXT for generation_id\nCREATE TABLE IF NOT EXISTS public.generated_images_new (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  generation_id TEXT NOT NULL,\n  image_url TEXT NOT NULL,\n  created_at TIMESTAMP WITH TIME ZONE DEFAULT now() NOT NULL\n);\n\n-- Rename tables\nDROP TABLE IF EXISTS public.generated_images_old;\n\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.tables \n    WHERE table_name = \'generated_images\' \n    AND table_schema = \'public\'\n  ) THEN\n    ALTER TABLE public.generated_images RENAME TO generated_images_old;\n  END IF;\nEND\n$$;\n\nALTER TABLE public.generated_images_new RENAME TO generated_images;\n\n-- Create indexes and RLS policies\nCREATE INDEX IF NOT EXISTS idx_generated_images_generation_id ON public.generated_images(generation_id);\n\nALTER TABLE public.generated_images ENABLE ROW LEVEL SECURITY;\n\n-- Drop existing policies if they exist\nDROP POLICY IF EXISTS "Users can view their own generated images" ON public.generated_images;\nDROP POLICY IF EXISTS "Service role can manage all generated images" ON public.generated_images;\n\n-- Create new policies\nCREATE POLICY "Users can view their own generated images" \n  ON public.generated_images FOR SELECT \n  USING (\n    EXISTS (\n      SELECT 1 FROM public.image_generations\n      WHERE id = generation_id AND user_id = auth.uid()\n    )\n  );\n\nCREATE POLICY "Service role can manage all generated images" \n  ON public.generated_images FOR ALL \n  USING (true);'),[r,o]=(0,i.useState)(!1),[d,c]=(0,i.useState)(null),u=async()=>{o(!0);try{let n=await fetch("/api/admin/run-sql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sql:e})}),r=await n.json();c(r)}catch(e){console.error("Error running SQL:",e),c({error:"Failed to run SQL"})}finally{o(!1)}};return(0,t.jsxs)("div",{className:"container mx-auto py-8",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Run SQL"}),(0,t.jsxs)(s.Zp,{className:"mb-6",children:[(0,t.jsxs)(s.aR,{children:[(0,t.jsx)(s.ZB,{children:"Run SQL"}),(0,t.jsx)(s.BT,{children:"Run SQL commands on the Supabase database"})]}),(0,t.jsxs)(s.Wu,{children:[(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)(l.T,{value:e,onChange:e=>n(e.target.value),className:"h-96"})}),(0,t.jsx)(a.$,{onClick:u,disabled:r,children:r?"Running...":"Run SQL"})]}),d&&(0,t.jsx)(s.wL,{children:(0,t.jsx)("pre",{className:"bg-gray-100 p-4 rounded overflow-auto w-full",children:JSON.stringify(d,null,2)})})]})]})}},3484:(e,n,r)=>{"use strict";r.d(n,{F:()=>s});var t=r(6522);let i=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,a=t.$,s=(e,n)=>r=>{var t;if((null==n?void 0:n.variants)==null)return a(e,null==r?void 0:r.class,null==r?void 0:r.className);let{variants:s,defaultVariants:l}=n,o=Object.keys(s).map(e=>{let n=null==r?void 0:r[e],t=null==l?void 0:l[e];if(null===n)return null;let a=i(n)||i(t);return s[e][a]}),d=r&&Object.entries(r).reduce((e,n)=>{let[r,t]=n;return void 0===t||(e[r]=t),e},{});return a(e,o,null==n?void 0:null===(t=n.compoundVariants)||void 0===t?void 0:t.reduce((e,n)=>{let{class:r,className:t,...i}=n;return Object.entries(i).every(e=>{let[n,r]=e;return Array.isArray(r)?r.includes({...l,...d}[n]):({...l,...d})[n]===r})?[...e,r,t]:e},[]),null==r?void 0:r.class,null==r?void 0:r.className)}},4666:(e,n,r)=>{"use strict";r.d(n,{T:()=>s});var t=r(8081),i=r(2149),a=r(7687);let s=i.forwardRef((e,n)=>{let{className:r,...i}=e;return(0,t.jsx)("textarea",{className:(0,a.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:n,...i})});s.displayName="Textarea"},5160:(e,n,r)=>{"use strict";r.d(n,{$:()=>d});var t=r(8081),i=r(2149),a=r(244),s=r(3484),l=r(7687);let o=(0,s.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=i.forwardRef((e,n)=>{let{className:r,variant:i,size:s,asChild:d=!1,...c}=e,u=d?a.DX:"button";return(0,t.jsx)(u,{className:(0,l.cn)(o({variant:i,size:s,className:r})),ref:n,...c})});d.displayName="Button"},6810:(e,n,r)=>{"use strict";r.d(n,{BT:()=>d,Wu:()=>c,ZB:()=>o,Zp:()=>s,aR:()=>l,wL:()=>u});var t=r(8081),i=r(2149),a=r(7687);let s=i.forwardRef((e,n)=>{let{className:r,...i}=e;return(0,t.jsx)("div",{ref:n,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...i})});s.displayName="Card";let l=i.forwardRef((e,n)=>{let{className:r,...i}=e;return(0,t.jsx)("div",{ref:n,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",r),...i})});l.displayName="CardHeader";let o=i.forwardRef((e,n)=>{let{className:r,...i}=e;return(0,t.jsx)("div",{ref:n,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",r),...i})});o.displayName="CardTitle";let d=i.forwardRef((e,n)=>{let{className:r,...i}=e;return(0,t.jsx)("div",{ref:n,className:(0,a.cn)("text-sm text-muted-foreground",r),...i})});d.displayName="CardDescription";let c=i.forwardRef((e,n)=>{let{className:r,...i}=e;return(0,t.jsx)("div",{ref:n,className:(0,a.cn)("p-6 pt-0",r),...i})});c.displayName="CardContent";let u=i.forwardRef((e,n)=>{let{className:r,...i}=e;return(0,t.jsx)("div",{ref:n,className:(0,a.cn)("flex items-center p-6 pt-0",r),...i})});u.displayName="CardFooter"},7687:(e,n,r)=>{"use strict";r.d(n,{cn:()=>a});var t=r(6522),i=r(4483);function a(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return(0,i.QP)((0,t.$)(n))}},9078:(e,n,r)=>{"use strict";r.d(n,{s:()=>s,t:()=>a});var t=r(2149);function i(e,n){if("function"==typeof e)return e(n);null!=e&&(e.current=n)}function a(...e){return n=>{let r=!1,t=e.map(e=>{let t=i(e,n);return r||"function"!=typeof t||(r=!0),t});if(r)return()=>{for(let n=0;n<t.length;n++){let r=t[n];"function"==typeof r?r():i(e[n],null)}}}}function s(...e){return t.useCallback(a(...e),e)}},9839:(e,n,r)=>{Promise.resolve().then(r.bind(r,3354))}},e=>{var n=n=>e(e.s=n);e.O(0,[1144,497,954,7358],()=>n(9839)),_N_E=e.O()}]);