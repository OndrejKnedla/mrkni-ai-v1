(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8733],{1855:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>f});var s=r(8081),i=r(2149),n=r(5160),a=r(6810),o=r(1888),c=r(2184),l=r(1018);let d=(0,l.A)("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),u=(0,l.A)("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);var h=r(4909),m=r(3849);function f(){let{user:e,loading:t}=(0,o.A)(),[r,l]=(0,i.useState)([]),[f,p]=(0,i.useState)(!0),[x,g]=(0,i.useState)(null),v=(null==e?void 0:e.email)&&(m.env.NEXT_PUBLIC_ADMIN_EMAILS||"").split(",").map(e=>e.trim()).includes(e.email);(0,i.useEffect)(()=>{e&&v?y():t||p(!1)},[e,t,v]);let y=async()=>{try{p(!0);let e=await fetch("/api/admin/list-users");if(!e.ok)throw Error("Failed to fetch users");let t=await e.json();l(t.users||[])}catch(e){console.error("Error fetching users:",e)}finally{p(!1)}},b=async(e,t)=>{try{if(g(e),!(await fetch("/api/admin/manage-subscription",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({targetUserId:e,tier:t,action:"add"})})).ok)throw Error("Failed to update subscription");await y()}catch(e){console.error("Error managing subscription:",e),alert("Failed to update subscription. See console for details.")}finally{g(null)}},w=async e=>{try{if(g(e),!(await fetch("/api/admin/manage-subscription",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({targetUserId:e,action:"delete"})})).ok)throw Error("Failed to remove subscription");await y()}catch(e){console.error("Error removing subscription:",e),alert("Failed to remove subscription. See console for details.")}finally{g(null)}};return t||f?(0,s.jsx)("div",{className:"container mx-auto px-4 py-8 flex items-center justify-center min-h-[60vh]",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(c.A,{className:"h-12 w-12 animate-spin mx-auto text-primary"}),(0,s.jsx)("p",{className:"mt-4 text-white drop-shadow-md",children:"Loading users..."})]})}):e&&v?(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"text-center mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-white drop-shadow-md",children:"User Management"}),(0,s.jsx)("p",{className:"text-white/70 mt-2",children:"Manage user subscriptions"})]}),(0,s.jsxs)("div",{className:"grid gap-6 max-w-6xl mx-auto",children:[r.map(e=>{var t,r,i,o,l;return(0,s.jsxs)(h.GlassCard,{className:"w-full",children:[(0,s.jsx)(a.aR,{children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(a.ZB,{className:"text-white",children:e.email}),(0,s.jsxs)(a.BT,{className:"text-white/70",children:["ID: ",e.id," â€¢ Created: ",new Date(e.created_at).toLocaleDateString()]})]}),(0,s.jsx)("div",{className:"text-right",children:(0,s.jsx)("span",{className:"inline-block px-2 py-1 rounded-full text-xs font-semibold ".concat((null===(t=e.subscription)||void 0===t?void 0:t.tier)==="premium"?"bg-green-600 text-white":(null===(r=e.subscription)||void 0===r?void 0:r.tier)==="basic"?"bg-orange-500 text-white":"bg-gray-500 text-white"),children:(null===(i=e.subscription)||void 0===i?void 0:i.tier)||"free"})})]})}),(0,s.jsx)(a.Wu,{children:(0,s.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,s.jsxs)(n.$,{size:"sm",variant:"outline",className:"bg-green-600/20 hover:bg-green-600/30 text-white",onClick:()=>b(e.id,"premium"),disabled:x===e.id||(null===(o=e.subscription)||void 0===o?void 0:o.tier)==="premium",children:[x===e.id?(0,s.jsx)(c.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsx)(d,{className:"mr-2 h-4 w-4"}),"Set Premium"]}),(0,s.jsxs)(n.$,{size:"sm",variant:"outline",className:"bg-orange-500/20 hover:bg-orange-500/30 text-white",onClick:()=>b(e.id,"basic"),disabled:x===e.id||(null===(l=e.subscription)||void 0===l?void 0:l.tier)==="basic",children:[x===e.id?(0,s.jsx)(c.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsx)(d,{className:"mr-2 h-4 w-4"}),"Set Basic"]}),(0,s.jsxs)(n.$,{size:"sm",variant:"outline",className:"bg-red-600/20 hover:bg-red-600/30 text-white",onClick:()=>w(e.id),disabled:x===e.id||!e.subscription||"free"===e.subscription.tier,children:[x===e.id?(0,s.jsx)(c.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsx)(u,{className:"mr-2 h-4 w-4"}),"Remove Subscription"]})]})})]},e.id)}),0===r.length&&(0,s.jsx)("div",{className:"text-center py-12",children:(0,s.jsx)("p",{className:"text-white/70",children:"No users found"})})]})]}):(0,s.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,s.jsx)(h.GlassCard,{className:"max-w-md mx-auto",children:(0,s.jsxs)(a.aR,{children:[(0,s.jsx)(a.ZB,{className:"text-white",children:"Access Denied"}),(0,s.jsx)(a.BT,{className:"text-white/70",children:"You do not have permission to access this page."})]})})})}},1888:(e,t,r)=>{"use strict";r.d(t,{A:()=>c,AuthProvider:()=>o});var s=r(8081),i=r(2149),n=r(4134);let a=(0,i.createContext)(void 0);function o(e){let{children:t}=e,[r,o]=(0,i.useState)(null),[c,l]=(0,i.useState)(!0);(0,i.useEffect)(()=>{(async()=>{try{let{data:{session:e}}=await n.N.auth.getSession();o((null==e?void 0:e.user)||null)}catch(e){console.error("Error checking session:",e)}finally{l(!1)}})();let{data:{subscription:e}}=n.N.auth.onAuthStateChange((e,t)=>{o((null==t?void 0:t.user)||null)});return()=>{e.unsubscribe()}},[]);let d=async()=>{try{console.log("Starting Google sign-in process...");let e="".concat(window.location.protocol,"//").concat(window.location.host);console.log("Using base URL for redirect: ".concat(e));let{data:t,error:r}=await n.N.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(e,"/auth/callback"),queryParams:{access_type:"offline",prompt:"consent"},scopes:"email profile"}});if(r)throw console.error("Google sign-in error:",r),r;console.log("Sign in initiated successfully, redirecting to Google",t)}catch(e){throw console.error("Error in signInWithGoogle:",e),e}},u=async(e,t)=>{let{error:r}=await n.N.auth.signInWithPassword({email:e,password:t});if(r)throw r},h=async(e,t)=>{let{error:r}=await n.N.auth.signUp({email:e,password:t});if(r)throw r},m=async()=>{let{error:e}=await n.N.auth.signOut();if(e)throw e};return(0,s.jsx)(a.Provider,{value:{user:r,loading:c,signInWithGoogle:d,signIn:u,signUp:h,signOut:m},children:t})}let c=()=>{let e=(0,i.useContext)(a);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},2184:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(1018).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},3849:(e,t,r)=>{"use strict";var s,i;e.exports=(null==(s=r.g.process)?void 0:s.env)&&"object"==typeof(null==(i=r.g.process)?void 0:i.env)?r.g.process:r(9798)},4134:(e,t,r)=>{"use strict";r.d(t,{N:()=>s});let s=(0,r(5331).createBrowserClient)("https://akqpnxofeitmzittndll.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFrcXBueG9mZWl0bXppdHRuZGxsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQxMzcxMjYsImV4cCI6MjA1OTcxMzEyNn0.vVH5D_odlSVOCOZ3BHfkxbDvhuOd_S3e05bQHqUR_pc",{})},4235:(e,t,r)=>{Promise.resolve().then(r.bind(r,1855))},4909:(e,t,r)=>{"use strict";r.d(t,{GlassCard:()=>a,GlassCardContent:()=>d,GlassCardDescription:()=>l,GlassCardHeader:()=>o,GlassCardTitle:()=>c,o:()=>u});var s=r(8081),i=r(6810),n=r(7687);function a(e){let{className:t,...r}=e;return(0,s.jsx)(i.Zp,{className:(0,n.cn)("glass-card",t),...r})}function o(e){let{className:t,...r}=e;return(0,s.jsx)(i.aR,{className:(0,n.cn)("text-on-bg",t),...r})}function c(e){let{className:t,...r}=e;return(0,s.jsx)(i.ZB,{className:(0,n.cn)("text-on-bg",t),...r})}function l(e){let{className:t,...r}=e;return(0,s.jsx)(i.BT,{className:(0,n.cn)("text-white/70",t),...r})}function d(e){let{className:t,...r}=e;return(0,s.jsx)(i.Wu,{className:(0,n.cn)(t),...r})}function u(e){let{className:t,...r}=e;return(0,s.jsx)(i.wL,{className:(0,n.cn)(t),...r})}},5160:(e,t,r)=>{"use strict";r.d(t,{$:()=>l});var s=r(8081),i=r(2149),n=r(244),a=r(3484),o=r(7687);let c=(0,a.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=i.forwardRef((e,t)=>{let{className:r,variant:i,size:a,asChild:l=!1,...d}=e,u=l?n.DX:"button";return(0,s.jsx)(u,{className:(0,o.cn)(c({variant:i,size:a,className:r})),ref:t,...d})});l.displayName="Button"},6810:(e,t,r)=>{"use strict";r.d(t,{BT:()=>l,Wu:()=>d,ZB:()=>c,Zp:()=>a,aR:()=>o,wL:()=>u});var s=r(8081),i=r(2149),n=r(7687);let a=i.forwardRef((e,t)=>{let{className:r,...i}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...i})});a.displayName="Card";let o=i.forwardRef((e,t)=>{let{className:r,...i}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",r),...i})});o.displayName="CardHeader";let c=i.forwardRef((e,t)=>{let{className:r,...i}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",r),...i})});c.displayName="CardTitle";let l=i.forwardRef((e,t)=>{let{className:r,...i}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",r),...i})});l.displayName="CardDescription";let d=i.forwardRef((e,t)=>{let{className:r,...i}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",r),...i})});d.displayName="CardContent";let u=i.forwardRef((e,t)=>{let{className:r,...i}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",r),...i})});u.displayName="CardFooter"},7687:(e,t,r)=>{"use strict";r.d(t,{cn:()=>n});var s=r(6522),i=r(4483);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,i.QP)((0,s.$)(t))}},9798:e=>{!function(){var t={229:function(e){var t,r,s,i=e.exports={};function n(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===n||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:n}catch(e){t=n}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var c=[],l=!1,d=-1;function u(){l&&s&&(l=!1,s.length?c=s.concat(c):d=-1,c.length&&h())}function h(){if(!l){var e=o(u);l=!0;for(var t=c.length;t;){for(s=c,c=[];++d<t;)s&&s[d].run();d=-1,t=c.length}s=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function f(){}i.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new m(e,t)),1!==c.length||l||o(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=f,i.addListener=f,i.once=f,i.off=f,i.removeListener=f,i.removeAllListeners=f,i.emit=f,i.prependListener=f,i.prependOnceListener=f,i.listeners=function(e){return[]},i.binding=function(e){throw Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw Error("process.chdir is not supported")},i.umask=function(){return 0}}},r={};function s(e){var i=r[e];if(void 0!==i)return i.exports;var n=r[e]={exports:{}},a=!0;try{t[e](n,n.exports,s),a=!1}finally{a&&delete r[e]}return n.exports}s.ab="//",e.exports=s(229)}()}},e=>{var t=t=>e(e.s=t);e.O(0,[1144,928,497,954,7358],()=>t(4235)),_N_E=e.O()}]);